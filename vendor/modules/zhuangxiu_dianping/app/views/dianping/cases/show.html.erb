<% city_name = CITIES[@user_city_code.to_i] %>
<% html_metadata = HtmlMetadata.find_by_page_id("#{city_name}:装修点评:案例图片终端页") %>
<% @title = html_metadata.title % {:case_name => @case.NAME} %>
<% @description = html_metadata.description  %>
<% @keywords = html_metadata.keywords % {:case_name => @case.NAME} %>
<% location "#{link_to @firm.name_abbr,firm_url(:id => @firm.id,:trailing_slash => "/")} > #{link_to '装修案例',firm_cases_url(:firm_id => @firm.id)}" %>
<% dp_js 'dianping/cases/show.js'%>
<link href="http://js.51hejia.com/css/sdeco.css?201012109" rel="stylesheet" type="text/css" />
<% firm_sub_menu %>
<!--end_submenu_code-->
<!--content_code-->
<div class="width960 clearfix margin10">
  <div id="casepic" class="clearfix">
    <div id="zxdp2010_anlileft">
      <div class="leftbox">
        <span style="text-align:center;"><h3><%= link_to @firm.name_abbr,firm_url(:id => @firm.id,:trailing_slash => "/"), :target => "_blank"%></h3></span>
        <div class="zxdp2010_anlibox02">
          <dl>

            <dd>
              <% if @firm_store_photos.size == 0 %>
                <%= link_to image_tag("http://img3.51hejia.com/img/zxdpimg/nopic02.jpg",:alt=>@firm.name_abbr), firm_url(@firm)%>
              <% else %>
                <%= link_to image_tag(@firm_store_photos.first.picture.url("131x98"),:alt=>@firm.name_abbr), firm_url(@firm)%>
              <% end -%>
            </dd>
            <dd class="zxdp2010_anlia01"><%= link_to "", firm_cases_path(@firm), :target=>"_blank"%></dd>
            <dd class="zxdp2010_anlia02"><a href="<%= firm_url(:id => @firm.id,:trailing_slash => "/")%>" target="_blank"></a></dd>
          </dl>
        </div>
      </div>
      <div class="leftbox">
        <h3><%=  @designer.nil? ? "相关信息" : "设计师信息"%></h3>
        <div class="zxdp2010_anlibox02">
          <% if @designer %>
            <dl>
              <dd>
                <%= link_to designer_avatar(@designer), firm_url(:id => @firm.id,:trailing_slash => "/"), :title => truncate_u(@designer.DESNAME,8)%>
              </dd>
              <dt>设计师：<%= truncate_u(@designer.DESNAME,8)%></dt>
              <dd>设计费：<%= @designer.desfee_text %></dd>
              <dd>擅长风格：<%= @designer.style_text %></dd>
              <dd>从业年限：<%= @designer.desage_text %></dd>
            </dl>
          <% end -%>

          <dl>
            <dt><strong><%= link_to @firm.name_abbr, firm_url(:id => @firm.id,:trailing_slash => "/"), :target => '_blank' %></strong></dt>
            <dt><%= link_to "设计师(#{CaseDesigner.firm_case_designer(@firm.id).count})", firm_designers_path(:firm_id => @firm.id,:trailing_slash => "/"), :target => '_blank'%></dt>
          </dl>
        </div>
      </div>
      <div class="leftbox">
        <h3>该公司其他设计师</h3>
        <div class="zxdp2010_anlibox02">
          <dl>
            <% @designers.each do |designer|%>
              <dd>
                <%= link_to designer_avatar(designer), designer_path(:id => designer.id, :trailing_slash => "/"), :class => "zxdp2010_anliahack", :target =>"_blank", :title => truncate_u(designer.DESNAME,8)%>
              </dd>
            <% end -%>
            <dd class="zxdp2010_anlia03"><%= link_to "更多&gt;&gt;", firm_designers_path(:firm_id => @firm.id), :target=>"_blank"%></dd>
          </dl>
        </div>
      </div>
    </div>
    <div id="centerbox">
      <div class="titbox1">
        <h2><%= @case.NAME%></h2>
      </div>
      <script language="javascript">
        function killErrors() {
          return true;
        }
        window.onerror = killErrors;
      </script>
      <script>
        function sf(){document.f.q.focus();}
        window.gbar={};(function(){var g=window.gbar,j,k;function l(a){var d=window.encodeURIComponent&&(document.forms[0].q||"").value;if(d)a.href=a.href.replace(/([?&])q=[^&]*|$/,function(h,f){return(f||"&")+"q="+encodeURIComponent(d)})}g.qs=l;function m(a,d,h,f,b,c){var i=document.getElementById(a),e=i.style;if(i){e.left=f?"auto":d+"px";e.right=f?d+"px":"auto";e.top=h+"px";e.visibility=k?"hidden":"visible";if(b){e.width=b+"px";e.height=c+"px"}else{m(j,d,h,f,i.offsetWidth,i.offsetHeight);k=k?"":a}}}g.tg=function(a){a=a||window.event;var d=0,h,f=window.navExtra,b,c=a.target||a.srcElement;a.cancelBubble=true;if(c.className!="gb3")c=c.parentNode;if(!j){b=document.createElement(Array.every||window.createPopup?"iframe":"div");b.frameBorder="0";b.src="#";j=c.parentNode.appendChild(b).id="gbs";document.onclick=g.close}a=c.getAttribute("aria-owns")||"gbi";b=c.offsetWidth;var i=c.offsetTop>20?46:24,e;do d+=c.offsetLeft||-150;while(c=c.offsetParent);if(a=="gbi")for(b=document.getElementById(a);f&&(h=f.pop());)b.insertBefore(h,b.firstChild).className="gb2";else e=d=(document.documentElement.clientWidth||document.body.clientWidth)-d-b;k!=a&&g.close();m(a,d,i,e)};g.close=function(){k&&m(k,0,0)}})();
      </script>
      <script type="text/javascript" src="http://js.51hejia.com/js/imgplayer2.js?20091015"></script>
      <div class="articlepic clearfix">
        <div class="artdesl">
          <ul>
            <li><%= link_to image_tag("http://js.51hejia.com/img/caseimages/good.gif",:alt => "顶"), case_up_path(@case.id),:id=>"caseup"%></li>
            <li id="uuu"><%= @case.CASEUP%></li>
            <li><%= link_to image_tag("http://js.51hejia.com/img/caseimages/bad.gif",:alt => "踩"), case_down_path(@case.id),:id=>"casedown"%></li>
            <li id="ddd"><%= @case.CASEDOWN%></li>
            <li id="save_case">
              <%= link_to image_tag("http://js.51hejia.com/img/caseimages/save.gif",:alt => "收藏本套案例"),
                "http://tuku.51hejia.com/zhuangxiu/tuku/down_case/#{@case.id}",:target=>"_blank"%>
            </li>

          </ul>
        </div>
        <div class="destag" id="chromemenu1">
          <ul>
            <li><%= link_to "全部(#{@photos.size})","http://tuku.51hejia.com/zhuangxiu/tuku/down_case/#{@case.id}",:target=>"_blank"%></li>

          </ul>
        </div>
        <div id="dropmenu1" class="dropmenudiv3"> </div>
        <script type="text/javascript">
          cssdropdown.startchrome("chromemenu1")
        </script>
        <div class="artdesr">

          <a href="http://tuku.51hejia.com/zhuangxiu!screen/tuku-529712" target="_blank" title="全屏"> <img src="http://www.51hejia.com/images/photo/des08.gif" alt="全屏" border="0"/> </a> </div>
        <div class="pic">
          <div class="top"></div>
          <div class="mai">
            <div class="up"><a id="pre_slide" title="上一张"></a></div>
            <p align="center" id="bigpic"> <img src="<%= @photos.first.get_photo_url if @case.photos.first %>" id="ss_img"
                                                style="filter:blendTrans(Duration=1);" onload="javascript:DrawImage(this)"/></p>
            <div class="down"><a id="next_slide" title="下一张"></a></div>
            <div class="info" id="tt"></div>
          </div>
          <div class="bottom">
            <div class="bpinlun">案例简介</div>
            <div class="autonum">
              <input type="text" name="slide_timeout" id="slide_timeout" value="10" size="2"/>


            </div>
            <div class="picbutton1" id="autoPlayImg">
              <div id="Play" style="display:none;"></div>
              <div id="Pause"></div>
            </div>
            <div class="brenqi">上传者：<b><%= truncate_u(@designer.DESNAME,8) if @designer%></b>&nbsp;|&nbsp;人气：<%= @case.pv %></div>
          </div>
        </div>
        <script type="text/javascript" language="javascript">
          // 幻灯片
          var ss = new slideshow("ss"); // slideshow.play 会通过setTimeout来调用ss.loop()的方法，所以必须把把变量设为全局可见。
          jQuery(function($) {
            ss.prefetch = 0; ss.sizelmt = true; ss.repeat = true; ss.timeout = $('#slide_timeout').val() * 1000; ss.textid='con';

<% @photos.each do |photo| %>
      ss.add_slide(new slide("<%= photo.get_photo_url%>", "<%= photo.get_photo_url%>", "", '_blank'));
<% end -%>

    $.each(ss.slides, function() { this.title = this.text });

    ss.pre_update_hook = function(){
      document.getElementById("tt").innerHTML = ss.slides[ss.current].title;
    }

    ss.image = $('#ss_img').get(0);
    if(ss.image) { ss.update(); ss.play() }

    $("#Play").click(function(event) {
      event.preventDefault();
      var t = parseInt($('#slide_timeout').val());
      ss.play((t < 1 || isNaN(t) ? 10 : t) * 1000);
      $(this).hide();
      $('#Pause').show();
    });

    $('#Pause').click(function(event) {
      event.preventDefault();
      ss.pause();
      $(this).hide();
      $('#Play').show();
    });

    $('#pre_slide').click(function(event) {
      event.preventDefault();
      ss.previous();
    });

    $('#next_slide').click(function(event) {
      event.preventDefault();
      ss.next();
    });
  });
        </script>
        <div class="ptext"><%=h @case.INTRODUCE%></div>
        <div class="clear"></div>
      </div>
      <script language="javascript">
        <!--
        //图片滚动列表
        var Speed_1 = 10; //速度(毫秒)
        var Space_1 = 20; //每次移动(px)
        var PageWidth_1 = 116 * 3; //翻页宽度
        var interval_1 = 7000; //翻页间隔
        var fill_1 = 0; //整体移位
        var MoveLock_1 = false;
        var MoveTimeObj_1;
        var MoveWay_1="right";
        var Comp_1 = 0;
        var AutoPlayObj_1=null;
        function GetObj(objName){if(document.getElementById){return eval('document.getElementById("'+objName+'")')}else{return eval('document.all.'+objName)}}
        function AutoPlay_1(){clearInterval(AutoPlayObj_1);AutoPlayObj_1=setInterval('ISL_GoDown_1();ISL_StopDown_1();',interval_1)}
        function ISL_GoUp_1(){if(MoveLock_1)return;clearInterval(AutoPlayObj_1);MoveLock_1=true;MoveWay_1="left";MoveTimeObj_1=setInterval('ISL_ScrUp_1();',Speed_1);}
        function ISL_StopUp_1(){if(MoveWay_1 == "right"){return};clearInterval(MoveTimeObj_1);if((GetObj('ISL_Cont_1').scrollLeft-fill_1)%PageWidth_1!=0){Comp_1=fill_1-(GetObj('ISL_Cont_1').scrollLeft%PageWidth_1);CompScr_1()}else{MoveLock_1=false}
          AutoPlay_1()}
        function ISL_ScrUp_1(){if(GetObj('ISL_Cont_1').scrollLeft<=0){GetObj('ISL_Cont_1').scrollLeft=GetObj('ISL_Cont_1').scrollLeft+GetObj('List1_1').offsetWidth}
          GetObj('ISL_Cont_1').scrollLeft-=Space_1}
        function ISL_GoDown_1(){clearInterval(MoveTimeObj_1);if(MoveLock_1)return;clearInterval(AutoPlayObj_1);MoveLock_1=true;MoveWay_1="right";ISL_ScrDown_1();MoveTimeObj_1=setInterval('ISL_ScrDown_1()',Speed_1)}
        function ISL_StopDown_1(){if(MoveWay_1 == "left"){return};clearInterval(MoveTimeObj_1);if(GetObj('ISL_Cont_1').scrollLeft%PageWidth_1-(fill_1>=0?fill_1:fill_1+1)!=0){Comp_1=PageWidth_1-GetObj('ISL_Cont_1').scrollLeft%PageWidth_1+fill_1;CompScr_1()}else{MoveLock_1=false}
          AutoPlay_1()}
        function ISL_ScrDown_1(){if(GetObj('ISL_Cont_1').scrollLeft>=GetObj('List1_1').scrollWidth){GetObj('ISL_Cont_1').scrollLeft=GetObj('ISL_Cont_1').scrollLeft-GetObj('List1_1').scrollWidth}
          GetObj('ISL_Cont_1').scrollLeft+=Space_1}
        function CompScr_1(){if(Comp_1==0){MoveLock_1=false;return}
          var num,TempSpeed=Speed_1,TempSpace=Space_1;if(Math.abs(Comp_1)<PageWidth_1/2){TempSpace=Math.round(Math.abs(Comp_1/Space_1));if(TempSpace<1){TempSpace=1}}
          if(Comp_1<0){if(Comp_1<-TempSpace){Comp_1+=TempSpace;num=TempSpace}else{num=-Comp_1;Comp_1=0}
            GetObj('ISL_Cont_1').scrollLeft-=num;setTimeout('CompScr_1()',TempSpeed)}else{if(Comp_1>TempSpace){Comp_1-=TempSpace;num=TempSpace}else{num=Comp_1;Comp_1=0}
            GetObj('ISL_Cont_1').scrollLeft+=num;setTimeout('CompScr_1()',TempSpeed)}}
        function picrun_ini(){
          GetObj("List2_1").innerHTML=GetObj("List1_1").innerHTML;
          GetObj('ISL_Cont_1').scrollLeft=fill_1>=0?fill_1:GetObj('List1_1').scrollWidth-Math.abs(fill_1);
          GetObj("ISL_Cont_1").onmouseover=function(){clearInterval(AutoPlayObj_1)}
          GetObj("ISL_Cont_1").onmouseout=function(){AutoPlay_1()}
          AutoPlay_1();
        }
        //展示滚动图片结束
        //-->
      </script>
      <% cache "dianping:cases:#{@case.ID}:left", :expires_in => 3.minutes do %>
        <div class="aboutpic clearfix">
          <h3>相关案例</h3>
          <A onmouseup="ISL_StopUp_1()" class="LeftBotton" onmousedown="ISL_GoUp_1()" onmouseout="ISL_StopUp_1()" href="javascript:void(0);" target="_self"></A>
          <div class="pcont" id="ISL_Cont_1">
            <div class="ScrCont">
              <div id="List1_1" >
                <!-- piclist begin -->
                <% @similar_cases.each do |c|%>
                  <a href="<%= c.url%>" target ="_blank" class="pl">
                    <%= image_tag(c.master_picture_url,:alt=>c.NAME)%><%= truncate_u(c.NAME,10) if c.NAME%>
                  </a>
                <% end -%>
                <!-- piclist end -->
              </div>
              <div id="List2_1"></DIV>
            </div>
          </div>
          <A onmouseup="ISL_StopDown_1()" class="RightBotton" onmousedown="ISL_GoDown_1()" onmouseout="ISL_StopDown_1()" href="javascript:void(0);" target="_self"></A> </div>
        <style type="text/css">
          .pagination{float:none; text-align:right;}
        </style>
      <% end -%>
      <%= render :partial => "/dianping/shared/remarks", :locals=>{ :resource_id => @case.id, :resource_type=> "Case"} %>

    </div>
    <% cache "dianping:cases:#{@case.ID}:right", :expires_in => 3.minutes do %>
      <div id="rightside">
        <% if @tags[4348] || @tags[4347] || @tags[4350] ||  (@case[:BUILDINGNAME] && @case[:BUILDINGNAME] != "") || @case.case_detail %>
          <div class="rightbox">
            <h3>案例信息</h3>
            <div class="zxdp2010_anlibox01">
              <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <%= formated_info("装修风格：", @tags, 4348, "", search_cases_for_options(:style => DecoFirm::STYLES.invert[@tags[4348]])) if @tags[4348] %>
                <%= formated_info("家庭成员：", @case.case_detail, :family_members) if @case.case_detail && @case.case_detail[:family_members] && @case.case_detail[:family_members] != "" %>
                <%= formated_info("楼盘信息：", @case, :BUILDINGNAME) if @case[:BUILDINGNAME] && @case[:BUILDINGNAME] != "" %>
                <%= formated_info("房型：", @tags, 4347,"", search_cases_for_options(:room => DecoFirm::ROOM.invert[@tags[4347].split(/\|/).first])) if @tags[4347] %>
                <%= formated_info "装修方式：", @tags, 4350, "", search_cases_for_options(:model => DecoFirm::MODELS.invert[@tags[4350]]) if @tags[4350]%>
                <%= formated_info("建筑面积：", @case.case_detail, :construction_area, "㎡") if @case.case_detail &&  @case.case_detail[:construction_area] && @case.case_detail[:construction_area] != "" %>
                <%= formated_info("使用面积：", @case.case_detail, :real_area, "㎡") if @case.case_detail && @case.case_detail[:real_area] && @case.case_detail[:real_area] != "" %>
                <%= formated_info("职业：", @case.case_detail, :job) if @case.case_detail && @case.case_detail[:job] && @case.case_detail[:job] != "" %>
              </table>
            </div>
          </div>
        <% end %>
        <% if @case.case_detail && @case.case_detail.total_cost.to_i > 0 %>
          <div class="rightbox">
            <h3>装修费用</h3>
            <div class="zxdp2010_anlibox01">
              <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <%= formated_info("硬装材料：", @case.case_detail, :hard_decoration_cost, "万") if @case.case_detail[:hard_decoration_cost] %>
                <%= formated_info("软装材料：", @case.case_detail, :soft_decoration_cost, "万") if @case.case_detail[:soft_decoration_cost] %>
                <%= formated_info("设计费：", @case.case_detail, :design_cost, "万") if @case.case_detail[:design_cost] %>
                <%= formated_info("管理费：", @case.case_detail, :management_cost, "万") if @case.case_detail[:management_cost] %>
                <%= formated_info("人工费：", @case.case_detail, :labor_cost, "万") if @case.case_detail[:labor_cost] %>
                <%= formated_info("税金：", @case.case_detail, :tax, "万") if @case.case_detail[:tax] %>
                <%= formated_info "总计：", @case.case_detail, :total_cost, "万" %>
                <tr>
                  <td colspan="2"><strong>总计：<%= @case.case_detail.total_cost %>万</strong></td>
                </tr>
              </table>
            </div>
          </div>
        <% end -%>
        <div class="rightbox">
          <h3><span><%= link_to "更多>>",firm_cases_path(:firm_id => @firm.id) %></span><%= @cases_title%></h3>
          <div class="righttext02">
            <ul class="clearfix">
              <% @cases.each do |c|%>
                <li><%= link_to image_tag(c.master_picture_url,:alt=>c.NAME), c.url, :target => "_blank" %></li>
              <% end -%>
            </ul>
          </div>
        </div>
      </div>
    <% end -%>
  </div>
</div>
<%= increase_pv_image_tag "hejia_case", @case.ID %>
</div>
<!--end_content_code-->
