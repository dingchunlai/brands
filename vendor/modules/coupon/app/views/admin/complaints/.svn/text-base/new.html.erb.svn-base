<%=include_jquery_easy_validator%>
<%= top_bar :title => '抵用券投诉管理',
            :button => ['投诉列表', admin_complaints_path],
            :breadcrumbs => [
              ['Homepage', coupon_admin_index_path],
              ['Complaints', admin_complaints_path]
            ]
%>
<% form_for @complaint, :url => admin_complaints_path do |f| %>
	<%= f.error_messages %>
<div class="table">
  <img src="/stylesheets/pretty_admin/img/bg-th-left.gif" width="8" height="7" alt="" class="left" />
  <img src="/stylesheets/pretty_admin/img/bg-th-right.gif" width="7" height="7" alt="" class="right" />
  <table class="listing form" cellpadding="0" cellspacing="0">
    <tr>
      <th class="full" colspan="2">新增投诉</th>
    </tr>
    <tr class="bg">
      <td class="first" width="172"><strong><%= f.label :coupon_code %></strong></td>
      <td class="last">
        <%= f.text_field :coupon_code, :class => "text", :reg => '^\d*$', :tip => "必须*" %>
        <%= f.hidden_field :coupon_id %><span id="msg_for_code"></span>
      </td>
    </tr>
    <tr>
      <td class="first"><strong><%= f.label :title %></strong></td>
      <td class="last"><%= f.text_field :title, :class => "text", :reg => '^\S+$', :tip => "必须*" %></td>
    </tr>
    <tr>
      <td class="first"><strong><%= f.label :name %></strong></td>
      <td class="last"><%= f.text_field :name, :class => "text", :reg => '^\S+$', :tip => "必须*" %></td>
    </tr>
    <tr class="bg">
      <td class="first" width="172"><strong><%= f.label :email %></strong></td>
      <td class="last"><%= f.text_field :email, :class => "text", :reg => '^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$', :tip => "必须*" %></td>
    </tr>    
    <tr class="bg">
      <td class="first" width="172"><strong><%= f.label :telphone %></strong></td>
      <td class="last"><%= f.text_field :telphone, :class => "text", :reg => '(^(\d{2,4}[-_－—]?)?\d{3,8}([-_－—]?\d{3,8})?([-_－—]?\d{1,7})?$)|(^0?1[35]\d{9}$)', :tip => "手机：11位手机号码(13987654321). 座机：3-4位区号，7-8位直播号码，1-4位分机号(021-58585888-1234)" %></td>
    </tr>
    <tr class="bg">
      <td class="first" width="172"><strong><%= f.label :address %></strong></td>
      <td class="last"><%= f.text_field :address, :class => "text" %></td>
    </tr>
    <tr>
      <td class="first" width="172" valign="top"><strong><%= f.label :body %></strong></td>
      <td class="last"><%= f.text_area :body, :class => "text", :rows => 5, :reg => '^\S([\s|\S])+', :tip => "必须* 首字母不能为空字符" %></td>
    </tr>
    <tr>
      <td class="first" width="172" valign="top"><strong><%= f.label :description %></strong></td>
      <td class="last"><%= f.text_area :description, :class => "text", :rows => 5, :tip => "必须* 首字母不能为空字符" %></td>
    </tr>
	<tr>
		<td colspan="2"><%= f.submit '提交' %></td>
	</tr>
  </table>
</div>
<% end %>
<script type="text/javascript">
  $(function(){
     $("#complaint_coupon_code").blur(function(){
        $("#msg_for_code").html("");
        if (!(new RegExp("^\\d*$", "g")).test($(this).attr("value"))) { return null; }
            $("#msg_for_code").html("<font color=gray><strong>查询中...</strong></font>");
            $.ajax({
                url: '/remote/check_coupon_exist/',
                type: 'get',
                data: {'code' : $(this).attr("value")},
                dataType: 'json',

                error: function(request) {
                    alert("请联系管理员");
                },

                success: function(data) {
                    if (data == null)
                    {
                        $("#msg_for_code").html("<font color=red><strong>无效的抵用券编号</strong></font>");
                    }
                    else
                    {
                        $("#msg_for_code").html("<font color=green><strong>ok</strong></font>");
                        $("#complaint_coupon_id").attr("value", data.id);
                    }
                }
            });
        
     });
  });
</script>
