<%=include_jquery_easy_validator%>
<%= top_bar :title => '业务员管理页',
            :button => ['业务员列表', admin_sales_profiles_path],
            :breadcrumbs => [
              ['首页', coupon_admin_index_path],
              ['业务员列表', admin_sales_profiles_path],
              ['设置附属信息']
            ]
%>
<% form_for @sales_profile, :url => admin_sales_profiles_path do |f| %>
  <%= f.error_messages %>
  <div class="table">
    <img src="/stylesheets/pretty_admin/img/bg-th-left.gif" width="8" height="7" alt="" class="left" />
    <img src="/stylesheets/pretty_admin/img/bg-th-right.gif" width="7" height="7" alt="" class="right" />
    <table class="listing form" cellpadding="0" cellspacing="0">
      <tr>
        <th class="full" colspan="2">创建业务员</th>
      </tr>
      <tr>
        <td class="first" width="172"><strong><%= f.label :user_id %></strong></td>
        <td class="last"><%= @user.rname %><%= f.hidden_field :user_id, :value => @user.id %></td>
      </tr>
      <tr>
        <td class="first" width="172"><strong><%= f.label :manager_id %></strong></td>
        <td class="last"><%= f.select :manager_id, RadminUser.with_manager_sales.map{|r| [r.rname, r.id]}.unshift(['-请选择-', '']), :class=> "text" %></td>
      </tr>
      <tr class="bg">
        <td class="first" width="172"><strong><%= f.label :city_id %></strong></td>
        <td class="last"><%= f.select :city_id, City.used_cities.map{|c| [c.name, c.id]}.unshift(['-请选择-', '']), {}, :class => "text", :reg => '^\S+$', :tip => "城市必选" %>输入<input type="text" name="txt_city" id="txt_city" /><input type="button" id="btn_city" value="定位城市"/></td>
      </tr>
      <tr>
        <td class="first" width="172"><strong><%= f.label :qq %></strong></td>
        <td class="last"><%= f.text_field :qq, :class => "text", :class => 'text', :reg => '[1-9][0-9]{1,}', :tip => '格式错误' %></td>
      </tr>
      <tr class="bg">
        <td class="first" width="172"><strong><%= f.label :email %></strong></td>
        <td class="last"><%= f.text_field :email, :class => "text", :reg => '\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*', :tip => "请正确输入邮箱地址" %></td>
      </tr>
      <tr>
        <td class="first" width="172"><strong><%= f.label :mobile %></strong></td>
        <td class="last"><%= f.text_field :mobile, :class => "text", :reg => '\d{11}', :tip => "请正确输入手机号码" %></td>
      </tr>
      <tr class="bg">
        <td class="first" width="172"><strong><%= f.label :telephone %></strong></td>
        <td class="last"><%= f.text_field :telephone, :class => "text" %></td>
      </tr>

      <tr>
        <td></td>
        <td><%= f.submit '提交' %></td>
      </tr>
    </table>
  </div>
<% end %>
<script type="text/javascript">
        $("input[type=button][id^='btn_']").click(function() {
          var flag = $(this).attr("id").replace('btn_', '');
          if ($("#txt_" + flag).val() == "") {
              alert('请填写' + $(this).val().replace('定位', '') + '!');
              $("#txt_" + flag).focus();
          } else {
              var got = false;
              $("#sales_profile_"+ flag +"_id").css("background-color", "green");
              $("#sales_profile_"+ flag +"_id").children().each(function(i) {
                  if ($(this).text() == $("#txt_" + flag).val()) {
                      got = true;
                      $("#txt_" + flag).attr("value", '');
                      $("#sales_profile_"+ flag +"_id").attr("selectedIndex", $(this).attr("index"));
                  }
              });
              $("#sales_profile_"+ flag +"_id").css("background-color", "");
              if (!got) {
                  alert('请填写正确的'+ $(this).val().replace('定位', ''));
                  $("#txt_" + flag).focus();
              }
          }
      });
</script>
