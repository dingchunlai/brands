<%= top_bar :title => "线下管理",
      :button => ['新建地址', new_admin_offline_path],
      :breadcrumbs => [
        ['首页', coupon_admin_index_path],
        ['线下信息', admin_offlines_path]
      ]
%>
<div  class="select-bar">
  <% form_tag admin_offlines_path, :method => :get do %>
  <label>
    城市：<%= select_tag :city_id, options_for_select(City.used_cities.map{ |t| [t.name, t.id] }.unshift(['-请选择-',0]), @city) %> 
    区域：<%= select_tag :area_id, options_for_select((@city ? District.by_city(@city) : []).map{ |t| [t.name, t.id] }.unshift(['-请选择-',0]), @area) %> 
  </label>
  <label>
    <input id="but" type="submit" value="查询" />
  </label>
  <% end %>
</div>

<div class="table">
  <img src="/stylesheets/pretty_admin/img/bg-th-left.gif" width="8" height="7" alt="" class="left" />
  <img src="/stylesheets/pretty_admin/img/bg-th-right.gif" width="7" height="7" alt="" class="right" />
  <table class="listing" cellpadding="0" cellspacing="0">
    <tr>
      <th>城市</th>
      <th>区域</th>
      <th class="first">地址</th>
      <th class="last">操作</th>
    </tr>
    <% @offline_addresses.each do |offline| %>
    <tr style="text-align: center">
      <td class="first style4"><%= offline.city && offline.city.name || '---' %></td>
      <td><%= offline.district && offline.district.name  || '---'%></td>
      <td><%=h offline.address %></td>
      <td class="last">
        <% if can? :update, offline %>
            <%= link_to "编辑", edit_admin_offline_path(offline) %>
        <% else %>
            &nbsp;
        <% end %>
        <% if can? :manage, offline %>
            <%= link_to "删除", admin_offline_path(offline), :method => :delete, :confirm => "Are you sure !" %>
        <% else %>
            &nbsp;
        <% end %>
      </td>
    </tr>
    <% end %>
  </table>
  <%= will_paginate @offline_addresses, :class => "digg_pagination" %>
</div>

<script type="text/javascript">
  $(function(){
    $('#city_id').change(function(){
      var dom = $('#area_id').empty();
      if(parseInt($('#city_id').val()) != 0){
        $.get("/remote/districts/" + $('#city_id').val(), function(data){
          $('<option />').val('0').text("-请选择-").appendTo(dom);  
          if(data.length > 0){
            $.each(data, function(_, area){
              $('<option />').val(area[1]).text(area[0]).appendTo(dom);
            });
          }
        });
      }else{
        $('<option />').val('0').text("-请选择-").appendTo(dom);  
        return false;
      }
    });
  });

</script>

