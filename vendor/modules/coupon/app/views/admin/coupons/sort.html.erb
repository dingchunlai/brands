<%= top_bar :title => '抵用券排序',
  :button => ['抵用券列表', admin_coupons_path],
  :breadcrumbs => [
  ['首页', coupon_admin_index_path],
  ['抵用券管理', admin_coupons_path],
  ['排序页面']
]
%>

<div class="select-bar">
  <% form_tag sort_admin_coupons_path, :method => :get do %>
    <label><%= select_tag :order, options_for_select([['标题', 0], ['编号', 1]],  @order) %></label> <label><%= text_field_tag :name, @name, :size => 20 %></label>
     <label>分类 <%= select_tag :priority, options_for_select([['-全部-', 0], ['优先组', 1], ['非优先', 2]],  @priority) %></label>
     <label>行业 <%= select_tag :tag_id, options_for_select(Tag.all_categories.map{|t| [t.TAGNAME, t.TAGID]}.unshift(['请选择', '']),  @tag_id) %></label>
     <label>城市 <%= select_tag :city_id, options_for_select(City.used_cities.map{|c| [c.name, c.id]}.unshift(['请选择', '']),  @city_id) %></label>
     <label><input type="submit" value="Search" /></label>
  <% end %>
</div>
<div class="table">
  <img src="/stylesheets/pretty_admin/img/bg-th-left.gif" width="8" height="7" alt="" class="left" />
  <img src="/stylesheets/pretty_admin/img/bg-th-right.gif" width="7" height="7" alt="" class="right" />
  <% form_tag insert_at_admin_coupons_path, :id => "coupon_form" do %>
  <table class="listing" cellpadding="0" cellspacing="0">
    <tr>
      <th>序列号</th>
      <th>抵用卷编号</th>
      <th>标题</th>
      <th>经销商</th>
      <th>名次</th>
      <th>操作</th>
    </tr>
    <% @coupons.each_with_index do |coupon, index|%>
      <tr>
        <td> <%= @count + index + 1 %> </td>
        <td> <%= coupon.code %> </td>
        <td>
          <% if can? :update, coupon %>
          <%= link_to coupon.title, edit_admin_coupon_path(coupon), :target => '_blank' %>
          <% else %>
          <%= coupon.title %>
          <% end %>
        </td>
        <td> <%= coupon.distributor_title %> </td>
        <td> <%= coupon.coupon_score %> </td>
        <td>
          <span id="span_<%= coupon.id %>">
            <% unless coupon.priority.blank? %>
              <% if can? :move, Coupon %>
              <%= link_to "置顶", move_admin_coupons_path(:coupon_id => coupon.id, :direction => "top") %> | 
              <%= link_to "置末", move_admin_coupons_path(:coupon_id => coupon.id, :direction => "bottom") %> | 
              <%= link_to "取消", move_admin_coupons_path(:coupon_id => coupon.id, :direction => "remove")  %> |
              <% end %>
            <% end %>
            <% if can? :insert_at, Coupon %>
            进入<input id="number_<%= coupon.id %>" type="text" size="5" onchange="if(/\D/.test(this.value)){alert('只能输入数字');this.value='';}" /> 名
            <input id="id_<%= coupon.id %>" type="button" value="提交" />
            <% end %>
          </span>
        </td>
      </tr>
    <%end%>
  </table>
  <input id="number" name="number" type="hidden" /><input id="coupon_id" name="coupon_id" type="hidden" />
  <% end %>
  <div>
    <%= will_paginate @coupons , :class => "digg_pagination", :previous_label => "上一页", :next_label => "下一页"%>
  </div>

</div>
<script type="text/javascript">

  $(function(){
      $('form input[type=button]').click(function(){
        var cou_id = $(this).attr('id').split('_')[1];
        var num_value = $("#number_" + cou_id).val();
        if(isNaN(num_value)){
          $("#number_" + cou_id).val(''); 
          alert("请重新输入数字 ! ");
        }else{
          if(num_value.length <= 0 || num_value == ''){
              alert("请输入数字! ");
          }else{
            $("#coupon_id").val(cou_id);
            $("#number").val(num_value);
            $('#coupon_form').submit();    
          }
        }

      });
  });
  
</script>
