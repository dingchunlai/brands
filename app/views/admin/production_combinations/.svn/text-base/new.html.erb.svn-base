<%= show_flash_message %>
<% form_for	:combination, :url => (@combination.new_record? && admin_production_combinations_path || admin_production_combination_path(@combination)), :html => {:method => (@combination.new_record? && :post || :put)} do |f| %>
	<fieldset>
    <legend><h3>新增组合案例信息</h3></legend>
    <ul>
			<li>所属品类：<%= f.select :tag_id, @tags.map { |b| [b.TAGNAME, b.TAGID] }, {:include_blank => '-- 请选择 --'}, 'data-ajax-url' => pinpai_pin_lei_path(':id:') %></li>     
    	<li>所属品牌：<% if @brand_tags %><%= f.select(:brand_id, @brand_tags.brands.map { |b| [b.name_zh, b.id] }, {:include_blank => '-- 请选择 --'}) %><% else %><%= f.select :brand_id, [['-- 请先选择品牌 --', '']] %><% end %></li>
      <li>标    题：<%= f.text_field :title	%></li>
      <li>内    容：<%= f.text_field :content	, :class => 'mceEditor'  %></li>
    </ul>
    <%= submit_tag '保存' %>
  </fieldset>
<% end %>
<%= render :partial => 'shared/enable_tinymce' %>

<script type='text/javascript'>
	(function(){
		function	categorySelectChange(){
			$('#combination_tag_id').change(function (event){
				event.preventDefault();
				var id = $(this).val();
				if(!id || id == '') {
          updateBrandSelectElement([]);
          return false;
        }
        var url = $(this).attr('data-ajax-url').replace(':id:', id);
        $.getJSON(url, function(data, textStatus) {
          if(textStatus == 'success') {
            updateBrandSelectElement(data);
          } else {
            alert('读取品牌数据出错！');
          }
        });
        return false;
			})
		}
		function updateBrandSelectElement(brands){
			var dom = $('#combination_brand_id').empty();
			if(!brands || brands.length < 1){
				$('<option />').val('').text('-- 没有品牌可选 --').appendTo(dom);
			}else{
				$('<option />').val('').text('-- 请选择 --').appendTo(dom);
        $.each(brands, function(_, brand) {
          $('<option />').val(brand.id).text(brand.name_zh).appendTo(dom);
        })
			}
		}
		
		
		$(function(){
			categorySelectChange();
		});
	})();
</script>